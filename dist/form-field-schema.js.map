{"version":3,"sources":["../src/form-field-schema.js"],"names":["FormFieldSchema","fullSchema","addSystemColumn","label","attribute","columnName","type","accessor","column","name","attributeName","_columns","push","_columnsByKey","addElementColumn","element","part","columnKey","key","rawColumn","_rawColumnsByKey","addRawElementColumn","id","columnObject","setupElementColumns","elementsForColumns","isHidden","hasHiddenParent","isAddressElement","isPhotoElement","isVideoElement","isAudioElement","isSignatureElement","findColumnByID","columns","find","e","columnForFieldKey","fieldKey","_allElements","container","flattenElements","_elementsForColumns","elements","allElements","skip","isSectionElement","isRepeatableElement","isLabelElement"],"mappings":";;;;;;AAAA;;;;AACA;;;;;;;;IAEqBA,e;AACnB,iCAAkC;AAAA,+BAArBC,UAAqB;AAAA,QAArBA,UAAqB,mCAAR,KAAQ;;AAAA;;AAChC,SAAKA,UAAL,GAAkBA,UAAlB;AACD;;4BAEDC,e,4BAAgBC,K,EAAOC,S,EAAWC,U,EAAYC,I,EAAMC,Q,EAAU;AAC5D,QAAMC,SAAS,2BAAiB,EAACC,MAAMN,KAAP;AACCO,qBAAeN,SADhB;AAECC,kBAAYA,UAFb;AAGCC,YAAMA,IAHP;AAICC,gBAAUA,QAJX,EAAjB,CAAf;AAKA,SAAKI,QAAL,CAAcC,IAAd,CAAmBJ,MAAnB;AACA,SAAKK,aAAL,CAAmBR,UAAnB,IAAiCG,MAAjC;AACD,G;;4BAEDM,gB,6BAAiBC,O,EAASC,I,EAAMV,I,EAAM;AACpC,QAAMW,YAAYD,OAAOD,QAAQG,GAAR,GAAc,GAAd,GAAoBF,IAA3B,GAAkCD,QAAQG,GAA5D;;AAEA,QAAMC,YAAY,KAAKC,gBAAL,CAAsBH,SAAtB,CAAlB;;AAEA;AACA;AACA;AACA;;AAEA,SAAKI,mBAAL,CAAyBN,OAAzB,EAAkCI,SAAlC,EAA6C,IAA7C,EAAmDb,QAAQa,UAAUb,IAArE,EAA2EU,IAA3E,EAAiFC,SAAjF;AACD,G;;4BAEDI,mB,gCAAoBN,O,EAASI,S,EAAWG,E,EAAIhB,I,EAAMU,I,EAAMC,S,EAAW;AACjE,QAAMM,eAAe,4BAAkB,EAACR,gBAAD,EAAUI,oBAAV,EAAqBb,UAArB,EAA2BgB,MAA3B,EAA+BN,UAA/B,EAAlB,CAArB;;AAEA,SAAKL,QAAL,CAAcC,IAAd,CAAmBW,YAAnB;AACA,SAAKV,aAAL,CAAmBI,SAAnB,IAAgCM,YAAhC;AACD,G;;4BAEDC,mB,kCAAsB;AACpB,yBAAsB,KAAKC,kBAA3B,kHAA+C;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,UAApCV,OAAoC;;AAC7C,UAAIA,QAAQW,QAAR,IAAoBX,QAAQY,eAAhC,EAAiD;AAC/C;AACD;;AAED,WAAKb,gBAAL,CAAsBC,OAAtB;;AAEA,UAAI,KAAKd,UAAL,IAAmBc,QAAQa,gBAA/B,EAAiD;AAC/C,aAAKd,gBAAL,CAAsBC,OAAtB,EAA+B,kBAA/B;AACA,aAAKD,gBAAL,CAAsBC,OAAtB,EAA+B,cAA/B;AACA,aAAKD,gBAAL,CAAsBC,OAAtB,EAA+B,OAA/B;AACA,aAAKD,gBAAL,CAAsBC,OAAtB,EAA+B,UAA/B;AACA,aAAKD,gBAAL,CAAsBC,OAAtB,EAA+B,gBAA/B;AACA,aAAKD,gBAAL,CAAsBC,OAAtB,EAA+B,YAA/B;AACA,aAAKD,gBAAL,CAAsBC,OAAtB,EAA+B,aAA/B;AACA,aAAKD,gBAAL,CAAsBC,OAAtB,EAA+B,SAA/B;AACD;;AAED,UAAI,KAAKd,UAAL,KAAoBc,QAAQc,cAAR,IAA0Bd,QAAQe,cAAlC,IAAoDf,QAAQgB,cAAhF,CAAJ,EAAqG;AACnG,aAAKjB,gBAAL,CAAsBC,OAAtB,EAA+B,UAA/B,EAA2C,OAA3C;AACA,aAAKD,gBAAL,CAAsBC,OAAtB,EAA+B,MAA/B,EAAuC,OAAvC;AACD;;AAED,UAAI,KAAKd,UAAL,IAAmBc,QAAQiB,kBAA/B,EAAmD;AACjD,aAAKlB,gBAAL,CAAsBC,OAAtB,EAA+B,WAA/B;AACD;AACF;AACF,G;;4BAEDkB,c,2BAAeX,E,EAAI;AACjB,WAAO,KAAKY,OAAL,CAAaC,IAAb,CAAkB;AAAA,aAAKC,EAAEd,EAAF,KAASA,EAAd;AAAA,KAAlB,CAAP;AACD,G;;4BAEDe,iB,8BAAkBC,Q,EAAUtB,I,EAAM;AAChC,QAAIA,IAAJ,EAAU;AACR,aAAO,KAAKH,aAAL,CAAmByB,WAAW,GAAX,GAAiBtB,IAApC,CAAP;AACD;;AAED,WAAO,KAAKH,aAAL,CAAmByB,QAAnB,CAAP;AACD,G;;;;wBAEa;AACZ,aAAO,KAAK3B,QAAZ;AACD;;;wBAEiB;AAChB,UAAI,CAAC,KAAK4B,YAAV,EAAwB;AACtB,aAAKA,YAAL,GAAoB,KAAKC,SAAL,CAAeC,eAAf,CAA+B,KAA/B,CAApB;AACD;AACD,aAAO,KAAKF,YAAZ;AACD;;;wBAEwB;AACvB,UAAI,CAAC,KAAKG,mBAAV,EAA+B;AAC7B,aAAKA,mBAAL,GAA2B,EAA3B;;AAEA,YAAMC,WAAW,KAAKC,WAAtB;;AAEA,8BAAsBD,QAAtB,yHAAgC;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,cAArB5B,OAAqB;;AAC9B,cAAM8B,OAAO9B,QAAQ+B,gBAAR,IACA/B,QAAQgC,mBADR,IAEAhC,QAAQiC,cAFR,IAGAjC,QAAQW,QAHrB;;AAKA,cAAI,CAACmB,IAAL,EAAW;AACT,iBAAKH,mBAAL,CAAyB9B,IAAzB,CAA8BG,OAA9B;AACD;AACF;AACF;;AAED,aAAO,KAAK2B,mBAAZ;AACD;;;;;;kBA3GkB1C,e","file":"form-field-schema.js","sourcesContent":["import ElementColumn from './schema/element-column';\nimport SimpleColumn from './schema/simple-column';\n\nexport default class FormFieldSchema {\n  constructor({fullSchema = false}) {\n    this.fullSchema = fullSchema;\n  }\n\n  addSystemColumn(label, attribute, columnName, type, accessor) {\n    const column = new SimpleColumn({name: label,\n                                     attributeName: attribute,\n                                     columnName: columnName,\n                                     type: type,\n                                     accessor: accessor});\n    this._columns.push(column);\n    this._columnsByKey[columnName] = column;\n  }\n\n  addElementColumn(element, part, type) {\n    const columnKey = part ? element.key + '_' + part : element.key;\n\n    const rawColumn = this._rawColumnsByKey[columnKey];\n\n    // if (column == null) {\n    //   if the column is null, that means it's a materialized column\n    //   throw new Error('Column not found for element ' + columnKey + Object.keys(this._rawColumnsByKey));\n    // }\n\n    this.addRawElementColumn(element, rawColumn, null, type || rawColumn.type, part, columnKey);\n  }\n\n  addRawElementColumn(element, rawColumn, id, type, part, columnKey) {\n    const columnObject = new ElementColumn({element, rawColumn, type, id, part});\n\n    this._columns.push(columnObject);\n    this._columnsByKey[columnKey] = columnObject;\n  }\n\n  setupElementColumns() {\n    for (const element of this.elementsForColumns) {\n      if (element.isHidden || element.hasHiddenParent) {\n        continue;\n      }\n\n      this.addElementColumn(element);\n\n      if (this.fullSchema && element.isAddressElement) {\n        this.addElementColumn(element, 'sub_thoroughfare');\n        this.addElementColumn(element, 'thoroughfare');\n        this.addElementColumn(element, 'suite');\n        this.addElementColumn(element, 'locality');\n        this.addElementColumn(element, 'sub_admin_area');\n        this.addElementColumn(element, 'admin_area');\n        this.addElementColumn(element, 'postal_code');\n        this.addElementColumn(element, 'country');\n      }\n\n      if (this.fullSchema && (element.isPhotoElement || element.isVideoElement || element.isAudioElement)) {\n        this.addElementColumn(element, 'captions', 'array');\n        this.addElementColumn(element, 'urls', 'array');\n      }\n\n      if (this.fullSchema && element.isSignatureElement) {\n        this.addElementColumn(element, 'timestamp');\n      }\n    }\n  }\n\n  findColumnByID(id) {\n    return this.columns.find(e => e.id === id);\n  }\n\n  columnForFieldKey(fieldKey, part) {\n    if (part) {\n      return this._columnsByKey[fieldKey + '_' + part];\n    }\n\n    return this._columnsByKey[fieldKey];\n  }\n\n  get columns() {\n    return this._columns;\n  }\n\n  get allElements() {\n    if (!this._allElements) {\n      this._allElements = this.container.flattenElements(false);\n    }\n    return this._allElements;\n  }\n\n  get elementsForColumns() {\n    if (!this._elementsForColumns) {\n      this._elementsForColumns = [];\n\n      const elements = this.allElements;\n\n      for (const element of elements) {\n        const skip = element.isSectionElement ||\n                     element.isRepeatableElement ||\n                     element.isLabelElement ||\n                     element.isHidden;\n\n        if (!skip) {\n          this._elementsForColumns.push(element);\n        }\n      }\n    }\n\n    return this._elementsForColumns;\n  }\n}\n"]}